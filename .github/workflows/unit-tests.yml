name: LLMUnity Package Tests

on:
  push:

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install Unity
        uses: game-ci/unity-builder@v4
        with:
          unityVersion: 2022.3.16f1
          components: "unity-test-framework"
        env:
          UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
          UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
          UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}

      - name: Build LLMUnity package
        run: |
          unity -batchmode -quit -createProject ../LLMUnityProject
          cp -R ../LLMUnity ../LLMUnityProject/Assets/LLMUnity
          unity -batchmode -quit -projectPath ../LLMUnityProject -exportPackage Assets/LLMUnity ../LLMUnityProject/LLMUnity.unitypackage

      - name: Run LLMUnity package tests
        run: |
          unity -batchmode -runTests -testPlatform editmode -projectPath ../LLMUnityProject
